@echo off
echo Checking for modules...
go list -m -u all | findstr /V "(latest)"
IF %ERRORLEVEL% NEQ 0 (
    echo All modules up to date.
    goto vulncheck
)

echo.
set /p choice=Some modules are outdated. Do you want to update them? (Y/N): 
if /I "%choice%"=="Y" (
    echo Updating modules...
    go get -u ./...
    go mod tidy
) else (
    echo Skipping update.
)

:vulncheck
echo.
echo Running vulnerability scan with govulncheck
go install golang.org/x/vuln/cmd/govulncheck@latest
govulncheck ./...

echo.
echo CI check complete. No critical issues found.
